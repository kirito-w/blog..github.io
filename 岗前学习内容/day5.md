# Day5

## 关于刷包升级(后台)：
- 1.进入tmp目录下；
- 2.拖入软件包，如果速度过慢，可以使用rz -be；
- 3.使用 nohup sysupgrade -F（强制升级） -n（不保留配置升级） 固件包名。（`sysupgrade校验时是从/tmp/sysinfo/board_name获取的本机硬件型号`）

================================================================================================

## Wireshark(包分析，抓取工具)：
### 概念：
- Wireshark（前称Ethereal）是一个`网络封包分析`软件。
- 网络封包分析软件的功能是截取网络封包，并尽可能显示出最为详细的网络封包资料。Wireshark使用WinPCAP作为接口，直接与网卡进行数据报文交换。

================================================================

## tcpdump（抓包工具）:
### 概念：
- 可以将网络中传送的数据包完全截获下来提供分析。
- 它支持针对网络层、协议、主机、网络或端口的过滤，并提供and、or、not等逻辑语句来帮助你去掉无用的信息。
- 用简单的话来定义tcpdump，就是——根据使用者的定义对网络上的数据包进行截获的包分析工具。

----------------------------------------------------------------

### tcpdump 命令行格式：
- tcpdump [-adeflnNOpqStvx] [-c 数量] [-F 文件名] [-i 网络接口] [-r 文件名] [-s 指定package大小] [-T 类型] [-w 文件名] [表达式]
- 常用表达式：
    - 关于类型的关键字：host，net，port；
    - 传输方向的关键字：src，dst，dst or src，dst and src；
    - 协议的关键字： fddi，ip，arp，rarp，tcp，udp等类型；
    - 逻辑运算：取非——‘not’，‘！’；与——‘and’，‘&&’；或——‘or’，‘||’。

----------------------------------------------------------------

### 关于tcpdump的指令使用:
举例：tcpdump tcp -i eth1 -t -s 0 -c 100 and dst port ! 22 and src net 192.168.1.0/24 -w /tmp/target.cap
- 1、`tcp`: ip icmp arp rarp 和 tcp、udp、icmp这些选项等都要放到第一个参数的位置，用来过滤数据报的类型
- 2、`-i eth1` : 只抓经过接口eth1的包
- 3、`-t` : 不显示时间戳
- 4、`-s 0` : 抓取数据包时默认抓取长度为68字节。加上-S 0 后可以抓到`完整的数据包`
- 5、`-c 100` : 只抓取100个数据包
- 6、`dst port ! 22` : 不抓取目标端口是22的数据包
- 7、`src net 192.168.1.0/24` : 数据包的源网络地址为192.168.1.0/24
- 8、`-w ./target.cap` : 保存成cap文件，方便用wireshark分析

----------------------------------------------------------------

### wireshark常用过滤规则：（Filter中输入过滤规则）
- 过滤ip地址包含有指定IP的数据：  ip.addr == 192.168.2.188
- 源ip过滤：ip.src == 39.104.225.201 （过滤源ip为:39.104.225.201的包）
- 目的ip过滤：ip.dst == 192.168.101.8 （过滤目的ip为192.168.101.8的包）
- tcp.port ==  80                （源端口和目的端口为80的包都过滤出来） 
- tcp.dstport == 80   			（只过滤目的端口为80的包） 	
- tcp.srcport == 80             （只过滤源端口为80的包）
- HTTP       			（过滤协议为HTTP的包） 
- ssh              		（过滤协议为ssht的包）
- http.request.method=="GET"       （过滤get包）
- http.request.method=="POST"     （过滤post包）
- ip.src==192.168.101.8 and http （过滤ip为192.168.101.8，并且为http协议的包）

----------------------------------------------------------------
### 抓取一些特殊的数据包：
- DNS包：
    - tcpdump -i eth0 -s 500 port domain
        - -i 选择网卡 
        - -s 数据包长度，0代表完整数据包
        - port domain 表示只抓取使用domain（域名）服务的数据包，即DNS查询和应答报文
    
----------------------------------------------------------------

- DHCP包：
    - tcpdump -i eth0 -c 8 -s 0 -w /tmp/target.cap 'udp and port 67 and port 68'
        - -i 选择网卡
        - -c 数据包个数
        - -s 数据包长度，0代表完整数据包
        - -w 写入文件
        - DHCP使用67和68端口

----------------------------------------------------------------

- ping包：
    - tcpdump -c 5 -i eth0 icmp
        - -i 选择网卡
        - -c 数据包个数
        - icmp 抓取Internet控制报文协议 

----------------------------------------------------------------

- 获取主机210.27.48.1接收或发出的telnet包：
    - tcpdump tcp port 23 and host 210.27.48.1
        - tcp 抓取TCP协议
        - host 主机地址
        - and “和”逻辑运算符
        - telnet使用23端口

----------------------------------------------------------------

- http包：
    - tcpdump -i eth0 'tcp port 80 and (tcp[((tcp[12:1] & 0xf0) >> 2):4] = 0x47455420)'
        - tcp port 80 表示tcpdump只捕获HTTP流量的端口为80。
        - (tcp[((tcp[12:1] & 0xf0) >> 2):4] = 0x47455420) 表示只捕获HTTP请求，其中0x47455420对应于字符串"GET "。


================================================================================================

## IxChariot(性能测试工具)：
----------------------------------------------------------------

### 概念：
- Chariot是目前世界上唯一认可的`应用层IP网络及网络设备的测试软件`，可提供`端到端，多操作系统，多协议测试，多应用`模拟测试，其应用范围包括`有线，无线，局域，广域网络及网络设备`；可以进行网络故障定位，用户投诉分析，系统评估，网络优化等。
- 从用户角度测试网络或网络参数（吞吐量，反应时间，延时，抖动，丢包等）。

----------------------------------------------------------------

### 参考文章：https://blog.csdn.net/weixin_34153142/article/details/106458773?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522168777083916800226588470%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&request_id=168777083916800226588470&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~rank_v31_ecpm-1-106458773-null-null.268^v1^koosearch&utm_term=windows%E6%89%93%E6%B5%81%E5%B7%A5%E5%85%B7IxChariot%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B&spm=1018.2226.3001.4450

----------------------------------------------------------------

### 操作要点：
- 1.两台设备都装好了endpoint（IxChariot），其中要至少有一个配置界面；
- 2.两台设备`处在同一子网内`，要保证可以通；
- 3.配置ixchariot，新建流->设置ip->选择协议->选择脚本->ok
- 4.复制流(增加流的数量)
- 5.设置跑流时间；
- 6.开始跑流。


================================================================================================

## iperf（性能测试工具）：
----------------------------------------------------------------

### 概念：

- Iperf 是一个网络性能测试工具。Iperf可以`测试最大TCP和UDP带宽性能`，具有多种参数和UDP特性，可以根据需要调整，可以`报告带宽、延迟抖动和数据包丢失`。

- 要使用iperf，`需要两台服务器`，一台运行在服务器模式下，另一台运行在客户端模式下。

----------------------------------------------------------------

### 原理：
- iperf 的原理是通过创建一个 TCP 或 UDP 的连接，并在这个连接上发送数据。客户端和服务器会相互交换信息以测量性能。
- iperf 还可以进行双向测试，即在同时进行上传和下载测试。它可以对网络连接进行带宽测试、报告延迟和丢包等问题，以及定位网络性能瓶颈。

----------------------------------------------------------------

### 在一台机器上同时开启客户端和服务器端的目的：
- 在同一台 PC 上同时运行客户端和服务器端，通常是为了`测试本地网络性能`。这种测试可以用于`评估计算机的吞吐量、延迟、丢包率和其他指标`。
- 通过在同一台计算机上同时运行iperf客户端和服务器端，可以`模拟本地网络的传输情况`，并快速测量本地网络的性能表现。

----------------------------------------------------------------

### 操作要点：
- 1.需要开启两个cmd窗口，一个作为服务器端，另一个作为客户端
- 2.服务器端操作：iperf3.7 -p 12345 -s
- 3.客户端操作（单线程TCP）：iperf3.7 -c 192.168.2.191（本机ip） -p 12345
- 4.客户端操作（多线程TCP）：iperf3.7 -c 192.168.2.191 -p 12345 -P 3（三个线程）
- 5.客户端操作（UDP）：iperf3.7 -c 192.168.2.191 -p 12345 -u
- 6.客户端操作（UDP双向）: iperf3.7 -c 192.168.2.191 -p 12345 -u -bidir
- 7.客户端操作（UDP反向）：iperf3.7 -c 192.168.2.191 -p 12345 -u -R

================================================================================================

## abs(性能测试工具)：
- ./abs -n 10 -c 1 https://www.baidu.com/
    - -n 要`发多少个请求数`
    - -c `每次`进行`多少请求`
    - 测试地址`必须是一个url`。  
    ![](img/%E5%9B%BE%E7%89%8729.png)

================================================================================================
## 交换机（透明网桥的升级版本）
----------------------------------------------------------------    
### 交换机工作原理：
- 1、交换机在`接收到数据帧以后`，首先、会`记录`数据帧中的`源MAC地址`和`对应的接口`到MAC表中。
- 2、接着、会`检查`自己的 `MAC表`中`是否有`数据帧中`目标MAC地址`的信息，如果`有`则会`根据` MAC 表中`记录的对应接口`将数据帧`发送`出去 (也就是`单播`)；如果`没有`，则会将该数据帧从`非接受接口`发送出去 (也就是`广播`，或者泛洪 Flood)。
- 交换机工作于`数据链路层`。

----------------------------------------------------------------

### 交换机的三个主要功能：
- ①学习：以太网交换机`了解每一端口相连设备的 MAC 地址`，并将`地址`同相应的`端口`映射起来存放在交换机`缓存`中的 MAC 地址表中。
- ②转发 / 过滤：当一个数据帧的目的地址在 MAC 地址表中`有映射`时，它`被转发`到`连接目的节点的端口`而不是所有端口（如该数据帧为广播 / 组播帧则转发至所有端口)。
- ③消除回路：当交换机`包括`一个`冗余回路`时，以太网交换机`通过生成树协议避免回路的产生`，同时`允许存在后备路径`。


================================================================================================

### 遗留问题：
- 串口刷包升级
- MTK方案和高通方案的无线终端查看命令
- iwpriv、wlanconfig指令的实操
- 网关上配置端口映射