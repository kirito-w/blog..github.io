
### DNS服务进程名:
- 进程名是`DNSmasq`

----------------------------------------------------------------------

### DNS过程中的名词：
- 本地域名服务器：当一个主机发出DNS查询的时候，这个查询的请求就会发送到本地域名服务器。
- 根域名服务器：`根域名服务器是最高层次的域名服务`。他知道所有顶级域名服务器的域名和IP地址。不管那个本地域名服务器若自己不能不能解析，那首先请求的就是根域名服务器。根域名服务器不会把待查询的域名直接转换成IP，而是`告诉本地域名服务器下一步应该找哪一个顶级域名服务器进行查询`。
- 顶级域名服务器：负责管理该顶级域名下的所有`二级域名`，当收到DNS查询请求后就会给出响应的应答，`可能是最终的结果，也可能是下一步应该找到的域名服务器的IP地址`。
- 权限域名服务器：权限域名服务器就是负责一个区的域名服务器，是基层干活的，比如宿管，各科老师，他负责一个更小的区域。`当一个权限服务还不能给出最后的回答时，就会告诉查询请求的DNS客户，下一步应该找哪个权限域名服务器`。

----------------------------------------------------------------------

### DNS查询的两种方式：
- 1、递归查询：如果 A 请求 B，那么 B 作为请求的接收者一定要给 A 想要的答案  
![](img/%E5%9B%BE%E7%89%8752.png)
- 2、迭代查询：如果接收者 B 没有请求者 A 所需要的准确内容，接收者 B 将告诉请求者 A，如何去获得这个内容，但是自己并不去发出请求
![](img/%E5%9B%BE%E7%89%8753.png)

----------------------------------------------------------------------
### DNS 查询的过程 :
- 注意：通常情况下 DNS 会将查找的信息缓存在浏览器或者计算机本地中，如果有相同的请求到来时，就不再会进行 DNS 查找，而会直接返回结果。`（DNS解析器=本地域名服务器）`
- DNS 的查找会经历下面这些步骤：
    - 用户在浏览器中输入网址 www.example.com 并点击回车后，查询会进入网络，并且由 DNS 解析器进行接收。
    - DNS 解析器会向根域名发起查询请求，要求返回顶级域名的地址。
    - 根 DNS 服务器会注意到`请求地址的前缀`并向 DNS 解析器`返回 com 的顶级域名服务器(TLD) 的 IP 地址列表`。
    - 然后，DNS 解析器会向顶级域名服务器发送查询报文，顶级域名服务器接收请求后，会根据域名的地址把`权限 DNS 服务器的 IP 地址返回`给 DNS 解析器。
    - 最后，DNS 解析器将查询直接发送到权限 DNS 服务器
    - `权限 DNS 服务器直接将 IP 地址返回给 DNS 解析器`，如果查询不到，会返回其他管理查询的域名的权限DNS服务器。
    - DNS 解析器将会使用 IP 地址响应 Web 浏览器
    - 一旦 DNS 查找的步骤返回了 http://example.com 的 IP 地址，浏览器就可以请求网页了。  
    ![](img/%E5%9B%BE%E7%89%8754.png)

----------------------------------------------------------------------

### DNS 缓存:
- DNS 缓存(DNS caching) 有时也叫做 DNS 解析器缓存，它是由操作系统维护的临时数据库，它包含有最近的网站和其他 Internet 域的访问记录。
- 也就是说， DNS 缓存只是计算机为了满足快速的响应速度而把已加载过的资源缓存起来，再次访问时可以直接快速引用的一项技术和手段。

----------------------------------------------------------------------

### DNS 缓存的工作流程:
- 在浏览器向外部发出请求之前，计算机会拦截每个请求并在 DNS 缓存数据库中查找域名，该数据库包含有最近的域名列表，以及 DNS 首次发出请求时 DNS 为它们计算的地址。

----------------------------------------------------------------------
### DNS 缓存方式：
- DNS 数据可缓存到各种不同的位置上，每个位置均将存储 DNS 记录，它的生存时间由 TTL(DNS 字段) 来决定。
    - 1） 浏览器缓存  
        - 当用户通过浏览器访问某域名时，浏览器首先会在自己的缓存中查找是否有该域名对应的IP地址（若曾经访问过该域名且没有清空缓存便存在）；
    - 2） 系统缓存  
        - 当浏览器缓存中无域名对应IP则会自动检查用户计算机系统`Hosts文件`DNS缓存是否有该域名对应IP；
    - 3） 路由器缓存  
        - 当浏览器及系统缓存中均无域名对应IP则进入路由器缓存中检查，以上三步均为客服端的DNS缓存；
    - 4） ISP（互联网服务提供商）DNS缓存  
        - 当在用户客服端查找不到域名对应IP地址，则将进入ISP DNS缓存中进行查询。比如你用的是电信的网络，则会进入电信的DNS缓存服务器中进行查找；
    - 5） 根域名服务器  
        - 当以上均未完成，则进入根服务器进行查询。全球仅有13台根域名服务器，1个主根域名服务器，其余12为辅根域名服务器。根域名收到请求后会查看区域文件记录，若无则将其管辖范围内顶级域名（如.com）服务器IP告诉本地DNS服务器；
    - 6） 顶级域名服务器  
        - 顶级域名服务器收到请求后查看区域文件记录，若无则将其管辖范围内主域名服务器的IP地址告诉本地DNS服务器；
    - 7） 主域名服务器  
        - 主域名服务器接受到请求后查询自己的缓存，如果没有则进入下一级域名服务器进行查找，并重复该步骤直至找到正确纪录；
    - 8）保存结果至缓存  
        - 本地域名服务器把返回的结果保存到缓存，以备下一次使用，同时将该结果反馈给客户端，客户端通过这个IP地址与web服务器建立链接。

----------------------------------------------------------------------

### DNS 代理 :
- DNS代理，全称域名系统代理，是一种网络代理服务，它通过`代替客户端向DNS服务器发送DNS查询请求`来实现域名解析。
- 一般情况下，客户端会直接向本地DNS服务器发送DNS查询请求，然后DNS服务器会返回对应的IP地址，客户端通过该IP地址访问服务器。
- 但是，在一些特殊的网络环境下，如防火墙、代理服务器等，可能会限制客户端`直接访问`外网DNS服务器，这时候就需要使用DNS代理。DNS代理可以代替客户端向DNS服务器发送查询请求，然后将响应结果返回给客户端，从而`绕过网络限制`，实现域名解析。