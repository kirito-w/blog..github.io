# 静态路由原理与配置
## 1、路由（Routing）
- 路由是指分组从源到目的地时，决定端到端路径的网络范围的进程 。路由工作在OSI参考模型第三层——网络层的数据包转发设备，是从源主机到目标主机的转发过程。

-----

## 2、路由器（Router）
### （1）路由器概述
- 路由器是连接两个或多个网络的硬件设备，在网络间起网关的作用，是读取每一个数据包中的地址然后决定如何传送的专用智能性的网络设备。
- 主要功能为`转发与寻址`，能够将数据包转发到正确的目的地，并在转发过程中选择最佳路经的设备。

### （2）路由器的工作原理
- 网络中的设备相互通信主要是用它们的IP地址，路由器只能根据具体的IP地址来转发数据。IP地址由网络地址和主机地址两部分组成。在Internet中采用的是由子网掩码来确定网络地址和主机地址。
- 子网掩码与IP地址一样都是32位的，并且这两者是一一对应的，子网掩码中“1”对应IP地址中的网络地址，“0”对应的是主机地址，网络地址和主机地址就构成了一个完整的IP地址。在同一个网络中，IP地址的网络地址必须是相同的。计算机之间的通信只能在具有相同网络地址的IP地址之间进行，如果想要与其他网段的计算机进行通信，则必须经过路由器转发出去。
- `不同网络地址的IP地址是不能直接通信的，即便它们距离非常近，也不能进行通信`。路由器的`多个端口可以连接多个网段`，`每个端口的IP地址的网络地址`都必须`与所连接的网段的网络地址一致`。`不同的端口`它的网络地址是不同的，所`对应的网段也是不同的`，这样才能使各个网段中的主机`通过自己网段的IP地址把数据发送到路由器`上。

### （3）路由器的应用功能
- ①实现IP、TCP、UDP、ICMP等网络的互连
- ②对数据进行处理。收发数据包，具有对数据的分组过滤、复用、加密、压缩及防护墙等各项功能
- ③依据路由表的信息，对数据包下一传输目的地进行选择
- ④进行外部网关协议和其他自治域之间拓扑信息的交换
- ⑤实现网络管理和系统支持功能

-----

## 3、路由表（Routing Table）
### （1）路由表概述
- 路由表是一个存储在路由器或者联网计算机中的电子表格（文件）或类数据库。路由表中存储着指向特定网络地址的路径（在有些情况下，还记录有路径的路由度量值）。路由表中含有网络周边的拓扑信息，它建立的主要目标是为了实现路由协议和静态路由选择。
- 路由表不直接参与数据包的传输，而是用于生成一个小型指向表，这个指向表仅仅包含由路由算法选择的数据包传输优先路径，这个表格通常为了优化硬件存储和查找而被压缩或提前编译。

### （2）路由表的内容
- ①destination：目的地址，用来标识IP包的目的地址或者目的网络。
- ②mask：网络掩码，与目的地址一起标识目的主机或者路由器所在的网段的地址。
- ③pre：标识路由加入IP路由表的优先级。可能到达一个目的地有多条路由，但是优先级的存在让他们先选择优先级高的路由进行利用。
- ④cost：路由开销，当到达一个目的地的多个路由优先级相同时，路由开销最小的将成为最优路由。
- ⑤interface：输出接口，说明IP包将从该路由器哪个接口转发。
- ⑥nexthop：下一跳IP地址，说明IP包所经过的下一个路由器。

### （3）路由表的形成方式
- ①`直连`网段
    - 配置IP地址，端口UP状态，形成直连路由并`自动生成网段与接口信息进路由表中`
- ②`非直连`网段
    - 对于非直连的网段，`需要静态路由或动态路由`，将网段添加到路由表中

-----

## 4、静态路由（Static Route）
### （1）静态路由概述
- 静态路由是一种路由的方式，路由项（routing entry）由手动配置，而非动态决定。与动态路由不同，静态路由是固定的，不会改变，即使网络状况已经改变或是重新被组态。一般来说，静态路由是由网络管理员逐项加入路由表。

### （2）静态路由的优缺点
- ①优点：使用静态路由的一个好处是网络安全保密性高。动态路由因为需要路由器之间频繁地交换各自的路由表，而对路由表的分析可以揭示网络的拓扑结构和网络地址等信息。因此，网络出于安全方面的考虑也可以采用静态路由。不占用网络带宽，因为静态路由不会产生更新流量，因此静态路由一般适用于中小型网络。
- ②缺点：大型和复杂的网络环境通常不宜采用静态路由。一方面，网络管理员难以全面地了解整个网络的拓扑结构；另一方面，当网络的拓扑结构和链路状态发生变化时，路由器中的静态路由信息需要大范围地调整，这一工作的难度和复杂程度非常高。当网络发生变化或网络发生故障时，不能重选路由，很可能使路由失败。

### （3）Linux下静态路由的配置命令
- ip route add 目标网段/子网掩码 via 下一跳地址 (dev 指定逻辑网卡)
    - 例如：ip route add 192.0.2.0/24 via 10.0.0.1 (dev br-lan)
    - `如果不指定逻辑网卡，则会识别下一跳地址的网关在哪个逻辑网卡上，自动设置成此网卡`
- ip route del 目标网段/子网掩码 via 下一跳地址 (dev 指定逻辑网卡) —— 删除路由
    - 例如：ip route del 192.0.2.0/24 via 10.0.0.1 (dev br-lan)
-----

## 5、默认路由（Default Route）
### （1）默认路由概述
- 默认路由（Default route），是对IP数据包中的目的地址找不到存在的其他路由时，路由器所选择的路由。目的地不在路由器的路由表里的所有数据包都会使用默认路由。这条路由一般会连去另一个路由器，而这个路由器也同样处理数据包: 如果知道应该怎么路由这个数据包，则数据包会被转发到已知的路由；否则，数据包会被转发到默认路由，从而到达另一个路由器。每次转发，路由都增加了一跳的距离。

### （2）Linux下默认路由的配置命令
ip route add default via 目标地址
例如: ip route add default via 192.168.2.1

-----

## 6、路由器转发数据包的封装过程
源目地址变化：IP地址不变（源PC与目标PC），MAC地址变（参与传输的PC、网关的MAC地址）

-----

## 7、交换与路由的对比
### （1）路由工作在网络层
- 根据“路由表”转发数据
- 路由选择
- 路由转发
### （2）交换工作在数据链路层
- 根据“MAC地址表”转发数据
- 硬件转发

## 8、静态路由、缺省路由、浮动静态路由有啥区别？
- https://www.eet-china.com/mp/a98472.html
